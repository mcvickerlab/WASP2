// Nextflow config for nf-test
//
// WASP2 Container Version Configuration
// ======================================
// Centralized container version to ensure consistency across all modules.
// Update this single location when upgrading WASP2 container version.
//
// Container sources:
//   - Docker: biocontainers/wasp2:<version>
//   - Singularity: https://depot.galaxyproject.org/singularity/wasp2:<version>
//
def wasp2_container_version = '1.4.0'

params {
    // WASP2 container references
    wasp2_container_docker      = "ghcr.io/mcvickerlab/wasp2:${wasp2_container_version}"
    wasp2_container_singularity = "ghcr.io/mcvickerlab/wasp2:${wasp2_container_version}"

    // Test data directory
    test_data_dir = "${projectDir}/tests/data"
    modules_testdata_base_path = "${projectDir}/../../tests/data"
}

process {
    // Resource defaults for testing
    cpus = 1
    memory = '2.GB'
    time = '1.h'

    // Override container for all WASP2 processes to use 1.4.0
    withName: 'WASP2_.*' {
        container = "ghcr.io/mcvickerlab/wasp2:${wasp2_container_version}"
    }

    // Override nf-core process containers for stub testing
    // These only need bash for touch/echo in stub blocks
    withName: 'SAMTOOLS_.*|BWA_.*' {
        container = "ghcr.io/mcvickerlab/wasp2:${wasp2_container_version}"
    }
}

docker {
    enabled = true
    runOptions = '-u $(id -u):$(id -g)'
}

singularity {
    enabled = false
}

profiles {
    docker {
        docker.enabled = true
        singularity.enabled = false
    }
    singularity {
        docker.enabled = false
        singularity.enabled = true
    }
    conda {
        docker.enabled = false
        singularity.enabled = false
        conda.enabled = true
    }
    stub {
        // Minimal resources for stub tests
        process {
            cpus = 1
            memory = '1.GB'
        }
    }
}

// Test output directory
params.outdir = "${projectDir}/test-output"
