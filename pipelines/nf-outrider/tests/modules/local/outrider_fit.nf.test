nextflow_process {

    name "Test Process OUTRIDER_FIT"
    script "../../../modules/local/outrider_fit/main.nf"
    process "OUTRIDER_FIT"

    tag "modules"
    tag "modules_local"
    tag "outrider"

    test("Should fit OUTRIDER model on count matrix - stub") {

        options "-stub-run"

        when {
            process {
                """
                input[0] = file("${projectDir}/tests/stub/count_matrix.tsv")
                input[1] = 0.05      // padj_cutoff
                input[2] = 2.0       // zscore_cutoff
                input[3] = 0         // encoding_dim (0 = auto)
                input[4] = 15        // max_iterations
                input[5] = 1e-5      // convergence
                """
            }
        }

        then {
            assert process.success
            assert process.out.model
            assert process.out.results
            assert process.out.versions
        }
    }

    test("Should respect custom encoding dimension - stub") {

        options "-stub-run"

        when {
            process {
                """
                input[0] = file("${projectDir}/tests/stub/count_matrix.tsv")
                input[1] = 0.01      // padj_cutoff
                input[2] = 3.0       // zscore_cutoff
                input[3] = 10        // encoding_dim
                input[4] = 20        // max_iterations
                input[5] = 1e-6      // convergence
                """
            }
        }

        then {
            assert process.success
            assert process.out.model
            assert process.out.results
            assert process.out.versions
        }
    }
}
