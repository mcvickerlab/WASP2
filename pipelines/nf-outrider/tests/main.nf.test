nextflow_pipeline {

    name "Test nf-outrider Pipeline"
    script "../main.nf"

    tag "pipeline"
    tag "outrider"

    test("Should run with minimal test data - stub") {

        options "-stub"

        when {
            params {
                outdir = "${outputDir}"
            }
        }

        then {
            assert workflow.success
        }
    }

    test("Should skip MAE when requested - stub") {

        options "-stub"

        when {
            params {
                outdir   = "${outputDir}"
                skip_mae = true
            }
        }

        then {
            assert workflow.success
        }
    }

    test("Should fail without required VCF") {

        options "-stub"

        when {
            params {
                vcf    = null
                outdir = "${outputDir}"
            }
        }

        then {
            assert workflow.failed
        }
    }

    test("Should fail without required GTF") {

        options "-stub"

        when {
            params {
                gtf    = null
                outdir = "${outputDir}"
            }
        }

        then {
            assert workflow.failed
        }
    }

    test("Should fail without required input") {

        options "-stub"

        when {
            params {
                input  = null
                outdir = "${outputDir}"
            }
        }

        then {
            assert workflow.failed
        }
    }

    test("Should fail with non-existent samplesheet") {

        options "-stub"

        when {
            params {
                input  = "${projectDir}/tests/stub/nonexistent_samplesheet.csv"
                outdir = "${outputDir}"
            }
        }

        then {
            assert workflow.failed
        }
    }

    test("Should fail with non-existent VCF") {

        options "-stub"

        when {
            params {
                vcf    = "${projectDir}/tests/stub/nonexistent.vcf.gz"
                outdir = "${outputDir}"
            }
        }

        then {
            assert workflow.failed
        }
    }

    test("Should fail with non-existent GTF") {

        options "-stub"

        when {
            params {
                gtf    = "${projectDir}/tests/stub/nonexistent.gtf"
                outdir = "${outputDir}"
            }
        }

        then {
            assert workflow.failed
        }
    }
}
