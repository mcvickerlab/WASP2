{
    "$schema": "https://json-schema.org/draft-07/schema",
    "$id": "https://raw.githubusercontent.com/Jaureguy760/WASP2/master/pipelines/nf-atacseq/nextflow_schema.json",
    "title": "nf-atacseq pipeline parameters",
    "description": "ATAC-seq Allelic Imbalance Pipeline with WASP2 mapping bias correction",
    "type": "object",
    "definitions": {
        "input_output_options": {
            "title": "Input/Output options",
            "type": "object",
            "fa_icon": "fas fa-terminal",
            "description": "Define where the pipeline should find input data and save output data.",
            "required": ["input"],
            "properties": {
                "input": {
                    "type": "string",
                    "format": "file-path",
                    "exists": true,
                    "mimetype": "text/csv",
                    "pattern": "^\\S+\\.csv$",
                    "description": "Path to samplesheet CSV file containing sample information.",
                    "help_text": "The samplesheet must have columns: sample, fastq_1, and optionally fastq_2 for paired-end data.",
                    "fa_icon": "fas fa-file-csv"
                },
                "outdir": {
                    "type": "string",
                    "format": "directory-path",
                    "description": "The output directory where results will be saved.",
                    "default": "./results",
                    "fa_icon": "fas fa-folder-open"
                },
                "publish_dir_mode": {
                    "type": "string",
                    "default": "copy",
                    "description": "Method used to save pipeline results to output directory.",
                    "help_text": "The Nextflow `publishDir` option specifies which intermediate files should be saved to the output directory. Options: 'symlink', 'rellink', 'link', 'copy', 'copyNoFollow', 'move'.",
                    "fa_icon": "fas fa-copy",
                    "enum": ["symlink", "rellink", "link", "copy", "copyNoFollow", "move"]
                }
            }
        },
        "reference_genome_options": {
            "title": "Reference genome options",
            "type": "object",
            "fa_icon": "fas fa-dna",
            "description": "Reference genome and index files required for alignment.",
            "required": ["fasta"],
            "properties": {
                "fasta": {
                    "type": "string",
                    "format": "file-path",
                    "exists": true,
                    "pattern": "^\\S+\\.fa(sta)?(\\.gz)?$",
                    "description": "Path to reference genome FASTA file.",
                    "help_text": "Required for alignment and variant calling.",
                    "fa_icon": "fas fa-file"
                },
                "fasta_fai": {
                    "type": "string",
                    "format": "file-path",
                    "description": "Path to FASTA index file (.fai). Auto-generated if missing.",
                    "fa_icon": "fas fa-file"
                },
                "bwa_index": {
                    "type": "string",
                    "format": "path",
                    "description": "Path to BWA index directory. Auto-generated if missing.",
                    "fa_icon": "fas fa-folder"
                },
                "bowtie2_index": {
                    "type": "string",
                    "format": "path",
                    "description": "Path to Bowtie2 index directory. Auto-generated if missing.",
                    "fa_icon": "fas fa-folder"
                }
            }
        },
        "variant_options": {
            "title": "Variant data options",
            "type": "object",
            "fa_icon": "fas fa-exchange-alt",
            "description": "Variant data required for WASP2 allelic analysis.",
            "properties": {
                "vcf": {
                    "type": "string",
                    "format": "file-path",
                    "exists": true,
                    "pattern": "^\\S+\\.(vcf|bcf|pgen)(\\.gz)?$",
                    "description": "Path to VCF/BCF/PGEN variant file with sample genotypes.",
                    "help_text": "Required for WASP2 mapping bias correction and allelic imbalance analysis.",
                    "fa_icon": "fas fa-file-code"
                },
                "vcf_tbi": {
                    "type": "string",
                    "format": "file-path",
                    "description": "Path to VCF tabix index (.tbi).",
                    "fa_icon": "fas fa-file"
                }
            }
        },
        "atacseq_options": {
            "title": "ATAC-seq specific options",
            "type": "object",
            "fa_icon": "fas fa-chart-area",
            "description": "Options specific to ATAC-seq analysis.",
            "properties": {
                "peaks": {
                    "type": "string",
                    "format": "file-path",
                    "pattern": "^\\S+\\.(bed|narrowPeak|broadPeak)(\\.gz)?$",
                    "description": "Path to pre-called peaks BED file.",
                    "help_text": "Optional. If not provided, peaks will be called using MACS2.",
                    "fa_icon": "fas fa-mountain"
                },
                "macs_gsize": {
                    "type": "string",
                    "default": "hs",
                    "description": "Effective genome size for MACS2 peak calling.",
                    "help_text": "Common values: 'hs' (human), 'mm' (mouse), 'ce' (C. elegans), 'dm' (Drosophila), or a numeric value.",
                    "fa_icon": "fas fa-ruler"
                }
            }
        },
        "aligner_options": {
            "title": "Aligner options",
            "type": "object",
            "fa_icon": "fas fa-align-left",
            "description": "Configure which aligner to use for read mapping.",
            "properties": {
                "aligner": {
                    "type": "string",
                    "default": "bwa",
                    "description": "Aligner to use for read mapping.",
                    "enum": ["bwa", "bowtie2"],
                    "fa_icon": "fas fa-map"
                }
            }
        },
        "wasp2_options": {
            "title": "WASP2 options",
            "type": "object",
            "fa_icon": "fas fa-balance-scale",
            "description": "Options for WASP2 mapping bias correction and allelic imbalance analysis.",
            "properties": {
                "wasp_min_count": {
                    "type": "integer",
                    "default": 10,
                    "minimum": 1,
                    "description": "Minimum allele count for allelic imbalance analysis.",
                    "help_text": "Variants with fewer than this many reads for either allele will be excluded.",
                    "fa_icon": "fas fa-sort-numeric-up"
                },
                "wasp_pseudocount": {
                    "type": "integer",
                    "default": 1,
                    "minimum": 0,
                    "description": "Pseudocount for beta-binomial model.",
                    "help_text": "Added to allele counts to avoid division by zero.",
                    "fa_icon": "fas fa-plus"
                },
                "wasp_threads": {
                    "type": "integer",
                    "default": 4,
                    "minimum": 1,
                    "description": "Number of threads for WASP2 internal processing.",
                    "fa_icon": "fas fa-microchip"
                },
                "wasp_include_indels": {
                    "type": "boolean",
                    "default": false,
                    "description": "Include insertions/deletions in allelic imbalance analysis.",
                    "fa_icon": "fas fa-indent"
                },
                "wasp_phased": {
                    "type": "boolean",
                    "default": false,
                    "description": "Use phased haplotype model for allelic analysis.",
                    "help_text": "Requires phased genotypes in VCF file.",
                    "fa_icon": "fas fa-code-branch"
                }
            }
        },
        "processing_options": {
            "title": "Processing options",
            "type": "object",
            "fa_icon": "fas fa-cogs",
            "description": "Options to skip specific pipeline steps.",
            "properties": {
                "skip_trimming": {
                    "type": "boolean",
                    "default": false,
                    "description": "Skip adapter trimming with fastp.",
                    "fa_icon": "fas fa-fast-forward"
                },
                "skip_fastqc": {
                    "type": "boolean",
                    "default": false,
                    "description": "Skip FastQC quality control.",
                    "fa_icon": "fas fa-fast-forward"
                },
                "skip_dedup": {
                    "type": "boolean",
                    "default": false,
                    "description": "Skip duplicate marking with Picard.",
                    "fa_icon": "fas fa-fast-forward"
                },
                "skip_wasp": {
                    "type": "boolean",
                    "default": false,
                    "description": "Skip WASP filtering (use original BAM).",
                    "help_text": "Disables mapping bias correction; original aligned BAM will be used for analysis.",
                    "fa_icon": "fas fa-fast-forward"
                },
                "skip_peak_calling": {
                    "type": "boolean",
                    "default": false,
                    "description": "Skip peak calling with MACS2.",
                    "help_text": "Requires --peaks parameter to provide pre-called peaks.",
                    "fa_icon": "fas fa-fast-forward"
                },
                "skip_multiqc": {
                    "type": "boolean",
                    "default": false,
                    "description": "Skip MultiQC report generation.",
                    "fa_icon": "fas fa-fast-forward"
                }
            }
        },
        "max_job_request_options": {
            "title": "Max resource options",
            "type": "object",
            "fa_icon": "fas fa-server",
            "description": "Set the maximum resource limits for pipeline processes.",
            "properties": {
                "max_cpus": {
                    "type": "integer",
                    "default": 16,
                    "minimum": 1,
                    "description": "Maximum number of CPUs that can be requested for any single process.",
                    "fa_icon": "fas fa-microchip"
                },
                "max_memory": {
                    "type": "string",
                    "default": "128.GB",
                    "pattern": "^\\d+(\\.\\d+)?\\.?\\s*(K|M|G|T)?B$",
                    "description": "Maximum amount of memory that can be requested for any single process.",
                    "fa_icon": "fas fa-memory"
                },
                "max_time": {
                    "type": "string",
                    "default": "240.h",
                    "pattern": "^(\\d+\\.?\\s*(s|m|h|d)\\.?\\s*)+$",
                    "description": "Maximum amount of time that can be requested for any single process.",
                    "fa_icon": "fas fa-clock"
                }
            }
        },
        "generic_options": {
            "title": "Generic options",
            "type": "object",
            "fa_icon": "fas fa-file-import",
            "description": "Less common options for the pipeline.",
            "properties": {
                "help": {
                    "type": "boolean",
                    "default": false,
                    "description": "Display help text.",
                    "fa_icon": "fas fa-question-circle",
                    "hidden": true
                },
                "version": {
                    "type": "boolean",
                    "default": false,
                    "description": "Display version and exit.",
                    "fa_icon": "fas fa-info-circle",
                    "hidden": true
                },
                "tracedir": {
                    "type": "string",
                    "default": "${params.outdir}/pipeline_info",
                    "description": "Directory to keep pipeline Nextflow trace, timeline, report, and DAG files.",
                    "fa_icon": "fas fa-folder"
                }
            }
        }
    },
    "allOf": [
        { "$ref": "#/definitions/input_output_options" },
        { "$ref": "#/definitions/reference_genome_options" },
        { "$ref": "#/definitions/variant_options" },
        { "$ref": "#/definitions/atacseq_options" },
        { "$ref": "#/definitions/aligner_options" },
        { "$ref": "#/definitions/wasp2_options" },
        { "$ref": "#/definitions/processing_options" },
        { "$ref": "#/definitions/max_job_request_options" },
        { "$ref": "#/definitions/generic_options" }
    ]
}
