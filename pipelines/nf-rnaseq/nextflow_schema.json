{
    "$schema": "https://json-schema.org/draft-07/schema",
    "$id": "https://raw.githubusercontent.com/mcvickerlab/WASP2/master/pipelines/nf-rnaseq/nextflow_schema.json",
    "title": "wasp2-nf-rnaseq pipeline parameters",
    "description": "RNA-seq Allele-Specific Expression (ASE) pipeline with WASP2 mapping bias correction",
    "type": "object",
    "definitions": {
        "input_output_options": {
            "title": "Input/Output options",
            "type": "object",
            "fa_icon": "fas fa-terminal",
            "description": "Define where the pipeline should find input data and save output data.",
            "required": ["input"],
            "properties": {
                "input": {
                    "type": "string",
                    "format": "file-path",
                    "exists": true,
                    "mimetype": "text/csv",
                    "pattern": "^\\S+\\.csv$",
                    "description": "Path to samplesheet CSV file containing sample information.",
                    "help_text": "The samplesheet must have columns for sample name and FASTQ file paths.",
                    "fa_icon": "fas fa-file-csv"
                },
                "outdir": {
                    "type": "string",
                    "format": "directory-path",
                    "description": "The output directory where results will be saved.",
                    "default": "./results",
                    "fa_icon": "fas fa-folder-open"
                },
                "publish_dir_mode": {
                    "type": "string",
                    "default": "copy",
                    "description": "Method used to save pipeline results to output directory.",
                    "help_text": "The Nextflow `publishDir` option specifies which intermediate files should be saved to the output directory. Options: 'symlink', 'rellink', 'link', 'copy', 'copyNoFollow', 'move'.",
                    "fa_icon": "fas fa-copy",
                    "enum": ["symlink", "rellink", "link", "copy", "copyNoFollow", "move"]
                }
            }
        },
        "reference_genome_options": {
            "title": "Reference genome options",
            "type": "object",
            "fa_icon": "fas fa-dna",
            "description": "Reference genome and index files required for alignment.",
            "properties": {
                "fasta": {
                    "type": "string",
                    "format": "file-path",
                    "exists": true,
                    "pattern": "^\\S+\\.fa(sta)?(\\.gz)?$",
                    "description": "Path to reference genome FASTA file.",
                    "help_text": "Required for STAR index generation if index not provided.",
                    "fa_icon": "fas fa-file"
                },
                "gtf": {
                    "type": "string",
                    "format": "file-path",
                    "exists": true,
                    "pattern": "^\\S+\\.gtf(\\.gz)?$",
                    "description": "Path to gene annotation GTF file.",
                    "help_text": "Required for transcript quantification and gene-level analysis.",
                    "fa_icon": "fas fa-file-alt"
                },
                "star_index": {
                    "type": "string",
                    "format": "path",
                    "description": "Path to STAR index directory.",
                    "help_text": "Pre-built STAR index. If not provided, will be generated from FASTA and GTF.",
                    "fa_icon": "fas fa-folder"
                }
            }
        },
        "variant_options": {
            "title": "Variant data options",
            "type": "object",
            "fa_icon": "fas fa-exchange-alt",
            "description": "Variant data required for WASP2 allelic analysis.",
            "properties": {
                "vcf": {
                    "type": "string",
                    "format": "file-path",
                    "exists": true,
                    "pattern": "^\\S+\\.(vcf|bcf|pgen)(\\.gz)?$",
                    "description": "Path to VCF/BCF/PGEN variant file with sample genotypes.",
                    "help_text": "Required for WASP2 mapping bias correction and allele-specific expression analysis.",
                    "fa_icon": "fas fa-file-code"
                },
                "samples": {
                    "type": "string",
                    "format": "file-path",
                    "description": "Path to samples file mapping RNA-seq samples to VCF sample IDs.",
                    "help_text": "Tab-delimited file with columns: rna_sample, vcf_sample.",
                    "fa_icon": "fas fa-file-alt"
                }
            }
        },
        "wasp2_options": {
            "title": "WASP2 options",
            "type": "object",
            "fa_icon": "fas fa-balance-scale",
            "description": "Options for WASP2 mapping bias correction and allele-specific expression analysis.",
            "properties": {
                "min_count": {
                    "type": "integer",
                    "default": 10,
                    "minimum": 1,
                    "description": "Minimum allele count for ASE analysis.",
                    "help_text": "Variants with fewer than this many reads for either allele will be excluded.",
                    "fa_icon": "fas fa-sort-numeric-up"
                },
                "pseudocount": {
                    "type": "integer",
                    "default": 1,
                    "minimum": 0,
                    "description": "Pseudocount for allelic ratio calculation.",
                    "help_text": "Added to allele counts to stabilize ratio estimates.",
                    "fa_icon": "fas fa-plus"
                },
                "include_indels": {
                    "type": "boolean",
                    "default": false,
                    "description": "Include insertions/deletions in ASE analysis.",
                    "help_text": "By default, only SNPs are considered for allele-specific expression.",
                    "fa_icon": "fas fa-indent"
                },
                "max_indel_len": {
                    "type": "integer",
                    "default": 10,
                    "minimum": 1,
                    "description": "Maximum indel length to include when include_indels is enabled.",
                    "fa_icon": "fas fa-ruler"
                }
            }
        },
        "processing_options": {
            "title": "Processing options",
            "type": "object",
            "fa_icon": "fas fa-cogs",
            "description": "Options to skip specific pipeline steps.",
            "properties": {
                "skip_analysis": {
                    "type": "boolean",
                    "default": false,
                    "description": "Skip imbalance statistical analysis.",
                    "help_text": "If enabled, only alignment and allele counting will be performed.",
                    "fa_icon": "fas fa-fast-forward"
                },
                "output_format": {
                    "type": "string",
                    "description": "ML output formats (comma-separated): zarr, parquet, anndata.",
                    "help_text": "Specify multiple formats separated by commas for ML-ready outputs.",
                    "fa_icon": "fas fa-cogs"
                }
            }
        },
        "max_job_request_options": {
            "title": "Max resource options",
            "type": "object",
            "fa_icon": "fas fa-server",
            "description": "Set the maximum resource limits for pipeline processes.",
            "properties": {
                "max_cpus": {
                    "type": "integer",
                    "default": 16,
                    "minimum": 1,
                    "description": "Maximum number of CPUs that can be requested for any single process.",
                    "fa_icon": "fas fa-microchip"
                },
                "max_memory": {
                    "type": "string",
                    "default": "128.GB",
                    "pattern": "^\\d+(\\.\\d+)?\\.?\\s*(K|M|G|T)?B$",
                    "description": "Maximum amount of memory that can be requested for any single process.",
                    "fa_icon": "fas fa-memory"
                },
                "max_time": {
                    "type": "string",
                    "default": "240.h",
                    "pattern": "^(\\d+\\.?\\s*(s|m|h|d)\\.?\\s*)+$",
                    "description": "Maximum amount of time that can be requested for any single process.",
                    "fa_icon": "fas fa-clock"
                }
            }
        },
        "generic_options": {
            "title": "Generic options",
            "type": "object",
            "fa_icon": "fas fa-file-import",
            "description": "Less common options for the pipeline.",
            "properties": {
                "help": {
                    "type": "boolean",
                    "default": false,
                    "description": "Display help text.",
                    "fa_icon": "fas fa-question-circle",
                    "hidden": true
                },
                "version": {
                    "type": "boolean",
                    "default": false,
                    "description": "Display version and exit.",
                    "fa_icon": "fas fa-info-circle",
                    "hidden": true
                },
                "tracedir": {
                    "type": "string",
                    "default": "${params.outdir}/pipeline_info",
                    "description": "Directory to keep pipeline Nextflow trace, timeline, report, and DAG files.",
                    "fa_icon": "fas fa-folder"
                }
            }
        }
    },
    "allOf": [
        { "$ref": "#/definitions/input_output_options" },
        { "$ref": "#/definitions/reference_genome_options" },
        { "$ref": "#/definitions/variant_options" },
        { "$ref": "#/definitions/wasp2_options" },
        { "$ref": "#/definitions/processing_options" },
        { "$ref": "#/definitions/max_job_request_options" },
        { "$ref": "#/definitions/generic_options" }
    ]
}
