nextflow_pipeline {

    name "Integration Test Pipeline RNASEQ_ASE"
    script "../main.nf"

    tag "pipeline"
    tag "integration"
    tag "wasp2"
    tag "rnaseq_ase"

    test("RNASEQ_ASE - integration test - full pipeline") {

        when {
            params {
                input      = "${projectDir}/tests/data/integration/samplesheet_integration.csv"
                vcf        = "${projectDir}/tests/data/integration/integration.vcf.gz"
                star_index = "${projectDir}/tests/data/integration/star_index"
                gtf        = "${projectDir}/tests/data/integration/integration.gtf"
                outdir     = "${outputDir}/results"
                min_count  = 1
            }
        }

        then {
            // Pipeline completes successfully
            assert workflow.success

            // Validate output directories exist
            assert path("${outputDir}/results/wasp/filtered").exists() : "WASP filtered directory missing"
            assert path("${outputDir}/results/counts").exists() : "Counts directory missing"
            assert path("${outputDir}/results/analysis").exists() : "Analysis directory missing"
        }
    }
}
