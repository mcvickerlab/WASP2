nextflow_process {

    name "Test Process STAR_ALIGN"
    script "../../../modules/local/star_align/main.nf"
    process "STAR_ALIGN"

    tag "modules"
    tag "modules_local"
    tag "star"
    tag "alignment"

    test("Should align paired-end reads with STAR - stub") {

        options "-stub-run"

        when {
            process {
                """
                input[0] = [
                    [ id:'test_sample', single_end:false ],
                    [ file('test_R1.fastq.gz'), file('test_R2.fastq.gz') ]
                ]
                input[1] = file('star_index')
                input[2] = file('genes.gtf')
                """
            }
        }

        then {
            assert process.success
            assert process.out.bam
            assert process.out.log_final
            assert process.out.versions
            assert snapshot(process.out).match()
        }
    }

    test("Should align single-end reads with STAR - stub") {

        options "-stub-run"

        when {
            process {
                """
                input[0] = [
                    [ id:'test_sample_se', single_end:true ],
                    [ file('test_R1.fastq.gz') ]
                ]
                input[1] = file('star_index')
                input[2] = file('genes.gtf')
                """
            }
        }

        then {
            assert process.success
            assert process.out.bam
            assert process.out.versions
            assert snapshot(process.out).match()
        }
    }
}
