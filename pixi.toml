# WASP2 pixi configuration
# pixi is a modern package manager for conda environments
# https://pixi.sh

[project]
name = "wasp2"
version = "1.2.0"
description = "Allele-specific analysis of next-generation sequencing data"
channels = ["bioconda", "conda-forge"]
platforms = ["linux-64", "osx-64", "osx-arm64"]

[tasks]
# Development tasks
test = { cmd = "pytest tests/ -v --tb=short -m 'not slow and not benchmark' --ignore=tests/benchmarks/ --cov=src --cov-report=term-missing" }
test-quick = { cmd = "pytest tests/ -v --tb=short -x -m 'not slow and not benchmark' --ignore=tests/benchmarks/" }
test-all = { cmd = "pytest tests/ -v --tb=short --cov=src --cov-report=term-missing --cov-report=xml" }
lint = { cmd = "ruff check src/ tests/" }
format = { cmd = "ruff format src/ tests/" }
typecheck = { cmd = "basedpyright src/" }

# Rust tasks
rust-build = { cmd = "maturin develop --release", cwd = "." }
rust-test = { cmd = "cargo test", cwd = "rust" }

# Combined tasks
dev = { depends-on = ["rust-build"] }
check = { depends-on = ["lint", "typecheck", "test-quick"] }
ci = { depends-on = ["lint", "typecheck", "rust-test", "test"] }

[dependencies]
# Core Python
python = ">=3.10,<3.13"

# Data processing
numpy = ">=1.21,<2.0"
pandas = ">=2.0,<2.3"
polars = ">=0.19"
scipy = ">=1.10"

# Bioinformatics
pysam = ">=0.21"
pybedtools = ">=0.9"
bedtools = ">=2.30"
bcftools = ">=1.10"
samtools = ">=1.10"
htslib = ">=1.10"
anndata = ">=0.10.7,<0.11"

# CLI
typer = ">=0.9"
rich = ">=13.0"

# Development tools
pytest = ">=7.0"
pytest-cov = ">=4.0"
ruff = ">=0.9"
basedpyright = ">=1.18"

# Rust build
rust = ">=1.70"
libclang = "*"
maturin = ">=1.4,<2.0"
pip = "*"

[feature.plink.dependencies]
plink2 = "*"

[feature.cyvcf2.dependencies]
cyvcf2 = ">=0.31"

[feature.benchmark.dependencies]
pytest-benchmark = ">=4.0"
memory-profiler = ">=0.61"
matplotlib = ">=3.7"
seaborn = ">=0.12"

[environments]
default = { features = [], solve-group = "default" }
full = { features = ["plink", "cyvcf2"], solve-group = "default" }
benchmark = { features = ["plink", "cyvcf2", "benchmark"], solve-group = "default" }
