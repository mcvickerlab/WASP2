digraph WASP2_Architecture {
	bgcolor=white compound=true dpi=300 fontname=Helvetica fontsize=8 newrank=true nodesep=0.3 pad=0.25 rankdir=LR ranksep=0.7 size="7.09,4.5" splines=polyline
	node [fontname=Helvetica fontsize=7 height=0.35 margin="0.1,0.05" penwidth=1.2 shape=box style="rounded,filled"]
	edge [arrowsize=0.7 color="#666666" penwidth=1.5]
	subgraph cluster_input {
		color="#B8C9DC" fillcolor="#F5F8FC" label=<<FONT POINT-SIZE="8"><B>Inputs</B></FONT>> labelloc=t margin=15 penwidth=1.5 style="rounded,filled"
		bam [label=<<B>BAM</B>> color="#555555" fillcolor="#E8E8E8" fontsize=8]
		vcf [label=<<B>VCF/BCF</B>> color="#555555" fillcolor="#E8E8E8" fontsize=8]
		bam -> vcf [style=invis]
	}
	subgraph cluster_mapping {
		color="#4477AA" fillcolor="#DCE9F4" label=<<TABLE BORDER="0" CELLBORDER="0" CELLSPACING="0">
                <TR><TD><FONT COLOR="#4477AA" POINT-SIZE="9"><B>1</B></FONT></TD>
                <TD><FONT COLOR="#4477AA" POINT-SIZE="8"><B>Read Filtering</B></FONT></TD></TR>
            </TABLE>> labelloc=t margin=15 penwidth=2 style="rounded,filled"
		m1_1 [label=<<B>Identify Variant Reads</B>> fillcolor="#4477AA" fontcolor=white fontsize=6]
		m1_2 [label=<<B>Swap Alleles</B>> fillcolor="#4477AA" fontcolor=white fontsize=6]
		m1_3 [label=<<B>Remap Sequences</B>> fillcolor="#4477AA" fontcolor=white fontsize=6]
		m1_4 [label=<<B>Concordance Filter</B>> fillcolor="#4477AA" fontcolor=white fontsize=6]
		m1_feat [label=<<I><FONT POINT-SIZE="5" COLOR="#555555">Any aligner supported</FONT></I>> margin=0 shape=plaintext]
		m1_1 -> m1_2 [arrowsize=0.5 color="#4477AA" penwidth=1.0]
		m1_2 -> m1_3 [arrowsize=0.5 color="#4477AA" penwidth=1.0]
		m1_3 -> m1_4 [arrowsize=0.5 color="#4477AA" penwidth=1.0]
		m1_4 -> m1_feat [style=invis]
	}
	subgraph cluster_counting {
		color="#228833" fillcolor="#D9EDDB" label=<<TABLE BORDER="0" CELLBORDER="0" CELLSPACING="0">
                <TR><TD><FONT COLOR="#228833" POINT-SIZE="9"><B>2</B></FONT></TD>
                <TD><FONT COLOR="#228833" POINT-SIZE="8"><B>Variant Counting</B></FONT></TD></TR>
            </TABLE>> labelloc=t margin=15 penwidth=2 style="rounded,filled"
		m2_1 [label=<<B>Filter Het Variants</B>> fillcolor="#228833" fontcolor=white fontsize=6]
		m2_2 [label=<<B>Feature Intersection</B>> fillcolor="#228833" fontcolor=white fontsize=6]
		m2_3 [label=<<B>Allele Counting</B>> fillcolor="#228833" fontcolor=white fontsize=6]
		m2_feat1 [label=<<I><FONT POINT-SIZE="5" COLOR="#555555">Per-SNV &amp; feature-level</FONT></I>> margin=0 shape=plaintext]
		m2_feat2 [label=<<I><FONT POINT-SIZE="5" COLOR="#555555">Phased haplotype support</FONT></I>> margin=0 shape=plaintext]
		m2_1 -> m2_2 [arrowsize=0.5 color="#228833" penwidth=1.0]
		m2_2 -> m2_3 [arrowsize=0.5 color="#228833" penwidth=1.0]
		m2_3 -> m2_feat1 [style=invis]
		m2_feat1 -> m2_feat2 [style=invis]
	}
	subgraph cluster_analysis {
		color="#CCBB44" fillcolor="#F5F2DC" label=<<TABLE BORDER="0" CELLBORDER="0" CELLSPACING="0">
                <TR><TD><FONT COLOR="#CCBB44" POINT-SIZE="9"><B>3</B></FONT></TD>
                <TD><FONT COLOR="#CCBB44" POINT-SIZE="8"><B>AI Detection</B></FONT></TD></TR>
            </TABLE>> labelloc=t margin=15 penwidth=2 style="rounded,filled"
		m3_1 [label=<<B>Aggregate Counts</B>> fillcolor="#CCBB44" fontcolor=white fontsize=6]
		m3_2 [label=<<B>Beta-Binomial Model</B>> fillcolor="#CCBB44" fontcolor=white fontsize=6]
		m3_3 [label=<<B>FDR Correction</B>> fillcolor="#CCBB44" fontcolor=white fontsize=6]
		m3_feat1 [label=<<I><FONT POINT-SIZE="5" COLOR="#555555">Multi-SNV aggregation</FONT></I>> margin=0 shape=plaintext]
		m3_feat2 [label=<<I><FONT POINT-SIZE="5" COLOR="#555555">Likelihood ratio test</FONT></I>> margin=0 shape=plaintext]
		m3_1 -> m3_2 [arrowsize=0.5 color="#CCBB44" penwidth=1.0]
		m3_2 -> m3_3 [arrowsize=0.5 color="#CCBB44" penwidth=1.0]
		m3_3 -> m3_feat1 [style=invis]
		m3_feat1 -> m3_feat2 [style=invis]
	}
	subgraph cluster_output {
		color="#B8C9DC" fillcolor="#F5F8FC" label=<<FONT POINT-SIZE="8"><B>Outputs</B></FONT>> labelloc=t margin=15 penwidth=1.5 style="rounded,filled"
		out_bam [label=<<B>Filtered<BR/>BAM</B>> color="#4477AA" fillcolor="#DCE9F4" fontsize=7]
		out_counts [label=<<B>Allele<BR/>Counts</B>> color="#228833" fillcolor="#D9EDDB" fontsize=7]
		out_ai [label=<<B>AI<BR/>Results</B>> color="#CCBB44" fillcolor="#F5F2DC" fontsize=7]
		out_bam -> out_counts [style=invis]
		out_counts -> out_ai [style=invis]
	}
	bam -> m1_1 [lhead=cluster_mapping penwidth=2.0]
	vcf -> m1_1 [lhead=cluster_mapping penwidth=2.0]
	m1_4 -> m2_1 [lhead=cluster_counting ltail=cluster_mapping penwidth=2.0]
	m2_3 -> m3_1 [lhead=cluster_analysis ltail=cluster_counting penwidth=2.0]
	m1_4 -> out_bam [arrowsize=0.6 color="#4477AA" penwidth=1.2 style=dashed]
	m2_3 -> out_counts [arrowsize=0.6 color="#228833" penwidth=1.2 style=dashed]
	m3_3 -> out_ai [arrowsize=0.6 color="#CCBB44" penwidth=1.2 style=dashed]
}
